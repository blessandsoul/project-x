# ðŸš€ Ultimate Ubuntu VPS Hosting Guide for Project X

This guide covers everything: Node.js, MySQL, Redis, Nginx, Security, and Storage.

---

## ðŸ›  Prerequisites
- Ubuntu 22.04 or 24.04 VPS
- A Domain Name pointing to your VPS IP
- SSH access

---

## Step 1: System Baseline
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install build-essential curl git ufw -y
```

---

## Step 2: Install Node.js (v24) via NVM
```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
source ~/.bashrc
nvm install 24
nvm use 24
```

---

## Step 3: MySQL & Redis (The "Engines")

### 1. Install Services
```bash
sudo apt install mysql-server redis-server -y
```

### 2. Configure MySQL
```bash
sudo mysql_secure_installation # Follow prompts to secure
```

```bash
sudo mysql -u root -p
# Inside MySQL:
CREATE DATABASE projectx_prod;
CREATE USER 'projectx_user'@'localhost' IDENTIFIED BY 'YOUR_SECURE_PASSWORD';
GRANT ALL PRIVILEGES ON projectx_prod.* TO 'projectx_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. Verify Redis
Redis is usually safe by default on localhost, but ensure it's running:
```bash
sudo systemctl status redis-server
```

---

## Step 4: Storage & Permissions ("Everything Else")
Your server handles file uploads. You must create the storage folder and give the app permission to write to it.

```bash
sudo mkdir -p /var/www/project-x/server/uploads
sudo chown -R $USER:$USER /var/www/project-x
chmod -R 755 /var/www/project-x/server/uploads
```

---

## Step 5: Security (Firewall)
Only open what is absolutely necessary. This prevents hackers from accessing MySQL or Redis directly.
```bash
sudo ufw allow OpenSSH
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

---

## Step 6: Clone & Build

### 1. Clone
```bash
git clone https://github.com/your-repo/project-x.git /var/www/project-x
cd /var/www/project-x
```

### 2. Frontend
```bash
cd client
npm install
npm run build
cd ..
```

### 3. Backend
```bash
cd server
npm install
npm run build
```

---

## Step 7: Data Migration (Local to Remote)
To move your current data (users, companies, records) to the VPS, follow these steps:

### 1. On your Local Machine (Export)
Run this command in your PowerShell/Terminal to export your local database:
```bash
# Replace 'myapp' with your actual local database name
mysqldump -u root -p myapp > full_database_dump.sql
```

### 2. Move Dump to VPS
Upload the file using SCP (Secure Copy):
```bash
# Replace 'user' and 'vps_ip' with your VPS credentials
scp full_database_dump.sql user@vps_ip:/var/www/project-x/server/
```

### 3. On your VPS (Import)
Connect to your VPS and import the data into your production database:
```bash
cd /var/www/project-x/server/
# Import the dump
mysql -u projectx_user -p projectx_prod < full_database_dump.sql
```

### 4. Apply Any New Migrations
If you've made code changes after the dump, run the latest migrations:
```bash
# Example: Apply most recent fix
mysql -u projectx_user -p projectx_prod < migrations/add_calculator_config.sql
```


---

## Step 8: Production PM2 Setup
```bash
npm install -g pm2
pm2 start ecosystem.config.cjs --only project-x-server
pm2 save
pm2 startup
# Run the command generated by 'pm2 startup' to ensure it starts on reboot
```

---

## Step 9: Nginx & SSL
Create config at `/etc/nginx/sites-available/project-x`:
```nginx
server {
    listen 80;
    server_name yourdomain.com; # IMPORTANT: Change this to your domain

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

Enable and secure with SSL:
```bash
sudo ln -s /etc/nginx/sites-available/project-x /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl restart nginx
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d yourdomain.com
```

---

## âœ… Final Production Verification
- [ ] **Redis**: Internal only (verified via `Step 5`)
- [ ] **MySQL**: Internal only (verified via `Step 5`)
- [ ] **Environment**: `.env` has `NODE_ENV=production` & `COOKIE_SECURE=true`
- [ ] **Permissions**: `server/uploads/` is writable by the app
- [ ] **Auto-Restart**: PM2 is configured to start on server reboot

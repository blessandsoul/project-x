import{a as Ne,b as be,x as ye,r as t,R as i,ar as B,as as q,j as e,S as h,B as d,I as r,A as Pe,q as Ae,s as Ce,Q as A}from"./index-zfRgVEOB.js";import{u as Z,a as O,F as W,b as x,c as p,d as f,e as g,f as H,g as C,o as $,s as N}from"./form-AwQThXHv.js";import{C as j,b as w,a as v,c as D,d as E}from"./card-DHN41EoD.js";import{T as Se}from"./textarea-CL0iUmjH.js";import{A as ke,h as Fe,a as De,b as _e,c as Ie,d as Ue,e as Te,f as Ee,g as Re}from"./alert-dialog-D3X7DhcZ.js";import"./label-cOKql5fo.js";const Le=$({username:N().min(3,"Username must be at least 3 characters").max(50,"Username must be at most 50 characters").regex(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, underscores, and hyphens"),email:N().email("Please enter a valid email address").max(255)}),Ye=$({currentPassword:N().min(1,"Current password is required"),newPassword:N().min(10,"Password must be at least 10 characters").max(255).regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[0-9]/,"Password must contain at least one number"),confirmPassword:N().min(1,"Please confirm your new password")}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),ze=$({password:N().min(1,"Password is required to delete your account"),reason:N().max(500).optional()}),Me=5*1024*1024,Ge=["image/jpeg","image/png","image/webp"];function Ve(s){return Ge.includes(s.type)?s.size>Me?{valid:!1,error:"Image must be smaller than 5MB"}:{valid:!0}:{valid:!1,error:"Please upload a JPEG, PNG, or WebP image"}}function Be(s){let o=0;return s.length>=10&&(o+=1),s.length>=14&&(o+=1),/[a-z]/.test(s)&&(o+=1),/[A-Z]/.test(s)&&(o+=1),/[0-9]/.test(s)&&(o+=1),/[^a-zA-Z0-9]/.test(s)&&(o+=1),o<=2?{strength:"weak",score:25,label:"Weak",color:"bg-red-500"}:o<=3?{strength:"fair",score:50,label:"Fair",color:"bg-orange-500"}:o<=4?{strength:"good",score:75,label:"Good",color:"bg-yellow-500"}:{strength:"strong",score:100,label:"Strong",color:"bg-green-500"}}const Je=()=>{const{t:s}=Ne(),o=be(),{user:n,isLoading:oe,refreshProfile:b,logout:J}=ye(),m=t.useRef(null),[Q,R]=t.useState(null),[L,_]=t.useState(null),[Y,I]=t.useState(null),[ie,X]=t.useState(!0),[S,K]=t.useState(!1),[z,ee]=t.useState(!1),y=Z({resolver:O(Le),defaultValues:{username:"",email:""}}),[U,se]=t.useState(!1),u=Z({resolver:O(Ye),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),[k,ae]=t.useState(!1),re=u.watch("newPassword"),T=re?Be(re):null,[M,ce]=t.useState(!1),[G,de]=t.useState(!1),[V,me]=t.useState(!1),F=Z({resolver:O(ze),defaultValues:{password:"",reason:""}}),[P,te]=t.useState(!1),[ue,le]=t.useState(!1);t.useEffect(()=>{n?(async()=>{try{const l=await B.get("/user/avatar");R(l.data.avatarUrl)}catch{}finally{X(!1)}})():X(!1)},[n]),t.useEffect(()=>{n&&y.reset({username:n.username||n.name||"",email:n.email||""})},[n,y]);const he=t.useCallback(a=>{const l=a.target.files?.[0];if(!l)return;const c=Ve(l);if(!c.valid){i.error(c.error),a.target.value="";return}I(l);const ne=new FileReader;ne.onload=ve=>{_(ve.target?.result)},ne.readAsDataURL(l)},[]),xe=t.useCallback(async()=>{if(Y){K(!0);try{const a=new FormData;a.append("avatar",Y);const l=await B.post("/user/avatar",a,{headers:{"Content-Type":"multipart/form-data"}});R(l.data.avatarUrl),_(null),I(null),m.current&&(m.current.value=""),await b(),i.success(s("profile.avatar.upload_success","Profile photo uploaded successfully"))}catch(a){const l=a.response?.data?.message||s("profile.avatar.upload_error","Failed to upload avatar");i.error(l)}finally{K(!1)}}},[Y,b,s]),pe=t.useCallback(async()=>{ee(!0);try{await B.delete("/user/avatar"),R(null),_(null),I(null),m.current&&(m.current.value=""),await b(),i.success(s("profile.avatar.delete_success","Profile photo removed successfully"))}catch(a){const l=a.response?.data?.message||s("profile.avatar.delete_error","Failed to delete avatar");i.error(l)}finally{ee(!1)}},[b,s]),fe=t.useCallback(()=>{_(null),I(null),m.current&&(m.current.value="")},[]),ge=t.useCallback(async a=>{se(!0);try{await q("PATCH","/account",{email:a.email,username:a.username}),await b(),i.success(s("profile.account.update_success","Account information updated"))}catch(l){const c=l.response?.data?.message||s("profile.account.update_error","Failed to update account information");i.error(c)}finally{se(!1)}},[b,s]),je=t.useCallback(async a=>{ae(!0);try{await q("POST","/account/change-password",{currentPassword:a.currentPassword,newPassword:a.newPassword}),u.reset(),i.success(s("profile.password.change_success","Password changed successfully. You will be logged out of other devices."))}catch(l){const c=l.response?.data?.message||s("profile.password.change_error","Failed to change password");i.error(c)}finally{ae(!1)}},[u,s]),we=t.useCallback(async a=>{te(!0);try{await q("POST","/account/deactivate",{password:a.password,reason:a.reason||void 0}),i.success(s("profile.delete.success","Account deactivated successfully. Redirecting...")),await J(),o("/",{replace:!0})}catch(l){const c=l.response?.data?.message||s("profile.delete.error","Failed to deactivate account");i.error(c),le(!1)}finally{te(!1)}},[J,o,s]);return oe&&!n?e.jsx("div",{className:"min-h-screen bg-muted/30 py-8 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx(h,{className:"h-10 w-48 mx-auto"}),e.jsxs(j,{children:[e.jsx(w,{children:e.jsx(h,{className:"h-6 w-32"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(h,{className:"h-20 w-20 rounded-full mx-auto"}),e.jsx(h,{className:"h-10 w-full"})]})]}),e.jsxs(j,{children:[e.jsx(w,{children:e.jsx(h,{className:"h-6 w-40"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(h,{className:"h-10 w-full"}),e.jsx(h,{className:"h-10 w-full"})]})]})]})}):n?e.jsx("div",{className:"min-h-screen bg-muted/30 py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>o(-1),"aria-label":s("common.back","Go back"),children:e.jsx(r,{icon:"mdi:arrow-left",className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s("profile.title","Profile Settings")})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-[380px_1fr] gap-6 gap-y-6 lg:gap-8",children:[e.jsx("div",{className:"lg:sticky lg:top-28 lg:self-start lg:z-20",children:e.jsxs(j,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:account-circle",className:"h-5 w-5"}),s("profile.avatar.title","Profile Photo")]}),e.jsx(E,{children:s("profile.avatar.description","Upload a profile picture. Max 5MB, JPEG/PNG/WebP.")})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[ie?e.jsx(h,{className:"h-32 w-32 rounded-full"}):e.jsxs(Pe,{className:"h-32 w-32 ring-4 ring-background shadow-lg",children:[e.jsx(Ae,{src:L||Q||void 0,alt:n.username||"Profile"}),e.jsx(Ce,{className:"text-4xl font-semibold",children:(n.username||n.email||"U").charAt(0).toUpperCase()})]}),L&&e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-md",children:e.jsx(r,{icon:"mdi:pencil",className:"h-3.5 w-3.5"})})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-lg",children:n.username||n.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.email})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{ref:m,type:"file",accept:"image/jpeg,image/png,image/webp",className:"hidden",onChange:he}),L?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(d,{onClick:xe,disabled:S,className:"w-full",children:S?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),s("profile.avatar.uploading","Uploading...")]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:check",className:"me-2 h-4 w-4"}),s("profile.avatar.save","Save Photo")]})}),e.jsxs(d,{variant:"outline",onClick:fe,disabled:S,className:"w-full",children:[e.jsx(r,{icon:"mdi:close",className:"me-2 h-4 w-4"}),s("common.cancel","Cancel")]})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>m.current?.click(),disabled:S||z,className:"w-full",children:[e.jsx(r,{icon:"mdi:upload",className:"me-2 h-4 w-4"}),s("profile.avatar.upload","Upload Photo")]}),Q&&e.jsx(d,{variant:"outline",onClick:pe,disabled:z||S,className:"w-full text-destructive hover:text-destructive",children:z?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),s("profile.avatar.deleting","Deleting...")]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:delete",className:"me-2 h-4 w-4"}),s("profile.avatar.delete","Remove")]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:s("profile.avatar.hint","Recommended: Square image, at least 200x200 pixels")})]})]})]})}),e.jsxs("div",{className:"space-y-6 md:space-y-0 md:contents lg:block lg:space-y-6",children:[e.jsxs(j,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:account-edit",className:"h-5 w-5"}),s("profile.account.title","Account Information")]}),e.jsx(E,{children:s("profile.account.description","Update your username and email address")})]}),e.jsx(v,{children:e.jsx(W,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(ge),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(x,{control:y.control,name:"username",render:({field:a})=>e.jsxs(p,{children:[e.jsx(f,{children:s("profile.username","Username")}),e.jsx(g,{children:e.jsx(A,{placeholder:s("profile.username_placeholder","Enter username"),...a,disabled:U})}),e.jsx(H,{className:"text-xs",children:s("profile.username_hint","3-50 characters. Letters, numbers, underscores, hyphens only.")}),e.jsx(C,{})]})}),e.jsx(x,{control:y.control,name:"email",render:({field:a})=>e.jsxs(p,{children:[e.jsx(f,{children:s("profile.email","Email")}),e.jsx(g,{children:e.jsx(A,{type:"email",placeholder:s("profile.email_placeholder","Enter email"),...a,disabled:U})}),e.jsx(C,{})]})})]}),e.jsx(d,{type:"submit",disabled:U,children:U?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),s("profile.saving","Saving...")]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:content-save",className:"me-2 h-4 w-4"}),s("profile.save_changes","Save Changes")]})})]})})})]}),e.jsxs(j,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:lock-reset",className:"h-5 w-5"}),s("profile.password.title","Change Password")]}),e.jsx(E,{children:s("profile.password.description","Update your password. You will be logged out of other devices.")})]}),e.jsx(v,{children:e.jsx(W,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(je),className:"space-y-4",children:[e.jsx(x,{control:u.control,name:"currentPassword",render:({field:a})=>e.jsxs(p,{children:[e.jsx(f,{children:s("profile.password.current","Current Password")}),e.jsx(g,{children:e.jsxs("div",{className:"relative",children:[e.jsx(A,{type:M?"text":"password",placeholder:"••••••••••",...a,disabled:k,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>ce(!M),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,children:e.jsx(r,{icon:M?"mdi:eye-off":"mdi:eye",className:"h-4 w-4"})})]})}),e.jsx(C,{})]})}),e.jsx(x,{control:u.control,name:"newPassword",render:({field:a})=>e.jsxs(p,{children:[e.jsx(f,{children:s("profile.password.new","New Password")}),e.jsx(g,{children:e.jsxs("div",{className:"relative",children:[e.jsx(A,{type:G?"text":"password",placeholder:"••••••••••",...a,disabled:k,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>de(!G),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,children:e.jsx(r,{icon:G?"mdi:eye-off":"mdi:eye",className:"h-4 w-4"})})]})}),e.jsx(H,{className:"text-xs",children:s("profile.password.requirements","Min 10 characters with uppercase, lowercase, and number")}),T&&e.jsx("div",{className:"space-y-1.5 mt-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${T.color}`,style:{width:`${T.score}%`}})}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground min-w-[60px] text-right",children:T.label})]})}),e.jsx(C,{})]})}),e.jsx(x,{control:u.control,name:"confirmPassword",render:({field:a})=>e.jsxs(p,{children:[e.jsx(f,{children:s("profile.password.confirm","Confirm New Password")}),e.jsx(g,{children:e.jsxs("div",{className:"relative",children:[e.jsx(A,{type:V?"text":"password",placeholder:"••••••••••",...a,disabled:k,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>me(!V),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,children:e.jsx(r,{icon:V?"mdi:eye-off":"mdi:eye",className:"h-4 w-4"})})]})}),e.jsx(C,{})]})}),e.jsx(d,{type:"submit",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),s("profile.password.changing","Changing...")]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:lock-check",className:"me-2 h-4 w-4"}),s("profile.password.change","Update Password")]})})]})})})]}),e.jsxs(j,{className:"border-destructive/50 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(w,{children:[e.jsxs(D,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(r,{icon:"mdi:account-remove",className:"h-5 w-5"}),s("profile.delete.title","Deactivate Account")]}),e.jsx(E,{children:s("profile.delete.description","Deactivate your account temporarily. You have 30 days to reactivate by logging in, after which your account and data will be permanently deleted.")})]}),e.jsxs(v,{children:[e.jsx("div",{className:"bg-destructive/10 border border-destructive/30 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(r,{icon:"mdi:alert-circle",className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-destructive",children:s("profile.delete.warning_title","Important: 30-Day Grace Period")}),e.jsxs("ul",{className:"mt-2 space-y-1 text-muted-foreground",children:[e.jsxs("li",{children:["• ",s("profile.delete.warning_1","Your account will be deactivated immediately")]}),e.jsxs("li",{children:["• ",s("profile.delete.warning_2","You have 30 days to reactivate by logging in")]}),e.jsxs("li",{children:["• ",s("profile.delete.warning_3","After 30 days, all data will be permanently deleted")]})]})]})]})}),e.jsx(W,{...F,children:e.jsxs(ke,{open:ue,onOpenChange:le,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(d,{type:"button",variant:"destructive",disabled:P,children:[e.jsx(r,{icon:"mdi:account-off",className:"me-2 h-4 w-4"}),s("profile.delete.button","Deactivate My Account")]})}),e.jsxs(De,{children:[e.jsxs(_e,{children:[e.jsx(Ie,{children:s("profile.delete.dialog_title","Deactivate your account?")}),e.jsx(Ue,{children:s("profile.delete.dialog_description","Your account will be deactivated immediately. You can reactivate it within 30 days by logging in. After 30 days, your account and all data will be permanently deleted.")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx(x,{control:F.control,name:"password",render:({field:a})=>e.jsxs(p,{children:[e.jsxs(f,{className:"text-destructive",children:[s("profile.delete.password_label","Confirm with your password")," *"]}),e.jsx(g,{children:e.jsx(A,{type:"password",placeholder:"••••••••••",...a,disabled:P})}),e.jsx(C,{})]})}),e.jsx(x,{control:F.control,name:"reason",render:({field:a})=>e.jsxs(p,{children:[e.jsx(f,{children:s("profile.delete.reason_label","Reason for leaving (optional)")}),e.jsx(g,{children:e.jsx(Se,{placeholder:s("profile.delete.reason_placeholder","Let us know why you are leaving..."),className:"resize-none",rows:3,...a,disabled:P})}),e.jsx(H,{children:s("profile.delete.reason_hint","Your feedback helps us improve our service")})]})})]}),e.jsxs(Te,{children:[e.jsx(Ee,{disabled:P,children:s("common.cancel","Cancel")}),e.jsx(Re,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:async a=>{if(a.preventDefault(),await F.trigger()){const c=F.getValues();await we(c)}},disabled:P,children:P?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),s("profile.delete.deleting","Deactivating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:account-off",className:"me-2 h-4 w-4"}),s("profile.delete.confirm","Yes, Deactivate My Account")]})})]})]})]})})]})]})]})]}),e.jsx("div",{className:"h-8"})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30 px-4",children:e.jsxs(j,{className:"w-full max-w-md text-center p-6",role:"alert","aria-live":"polite",children:[e.jsx(w,{children:e.jsx(D,{children:s("profile.not_found","User not found")})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("profile.login_again","Please log in to access your profile")}),e.jsxs(d,{onClick:()=>o("/login"),className:"w-full",children:[e.jsx(r,{icon:"mdi:login",className:"me-2 h-4 w-4"}),s("profile.back_to_login","Back to Login")]})]})]})})};export{Je as default};

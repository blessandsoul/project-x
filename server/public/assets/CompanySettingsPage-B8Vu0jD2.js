import{a as Re,b as Ie,x as Be,r as n,aw as pe,j as e,S as _,B as b,I as r,W as h,X as w}from"./index-CIs9PTNC.js";import{C as g,b as j,a as x,c as y,d as N}from"./card-DxlEVSk-.js";import{L as o}from"./label-i423U0_n.js";import{T as I}from"./textarea-RNN0Bmvp.js";import{C as Ge}from"./checkbox-C9hYRJNU.js";import{S as We}from"./separator-DkinH34v.js";import{A as Te,h as Ye,a as Me,b as $e,c as ze,d as He,e as Je,f as Oe,g as qe}from"./alert-dialog-CbUzGru5.js";import{f as Xe}from"./services-Cnmj3-PH.js";import{b as Ke,g as Qe,h as Ve,i as Ze,e as es,j as ss}from"./companiesApi-B4b_-iFn.js";const ms=()=>{const{t:a}=Re(),L=Ie(),{isLoading:ge,companyId:d,refreshProfile:B}=Be(),[xe,G]=n.useState(!0),[c,W]=n.useState(!1),[l,T]=n.useState(!1),[Y,v]=n.useState(""),[M,$]=n.useState(""),[z,H]=n.useState(""),[k,J]=n.useState(""),[F,O]=n.useState(""),[A,q]=n.useState(""),[X,K]=n.useState(""),[Q,V]=n.useState(""),[Z,ee]=n.useState(""),[se,ae]=n.useState(""),[te,ie]=n.useState(""),[ne,D]=n.useState(new Date().getFullYear()),[ue,je]=n.useState(0),[fe,ye]=n.useState(0),[_e,be]=n.useState(0),[Ne,ve]=n.useState(0),[we,Se]=n.useState(0),[E,P]=n.useState([]),[f,S]=n.useState([]),[ce,le]=n.useState(null),[re,U]=n.useState(null),[C,oe]=n.useState(null),[Ce,Le]=n.useState([]),[ke,Fe]=n.useState(!0);n.useEffect(()=>{if(!d){G(!1);return}let s=!0;return Ke(d).then(t=>{if(!t||!s)return;H(t.name||""),J(t.description_geo||""),O(t.description_eng||""),q(t.description_rus||""),K(t.contact_email||""),V(t.phone_number||""),ee(t.website||""),ae(t.country||""),ie(t.city||""),je(Number(t.base_price)||0),ye(Number(t.price_per_mile)||0),be(Number(t.customs_fee)||0),ve(Number(t.service_fee)||0),Se(Number(t.broker_fee)||0),P(Array.isArray(t.services)?t.services:[]);const i=t.established_year;typeof i=="number"&&i>=1900&&i<=2100?D(i):D(new Date(t.created_at).getFullYear());const p=t.social_links;if(Array.isArray(p)){const R=p.filter(u=>u&&typeof u.url=="string"&&u.url.trim().length>0&&u.link_type==="social").map(u=>({id:u.id,platform:u.platform||"facebook",url:u.url||""}));S(R)}const m=t.logo_url||t.logo||null;m&&typeof m=="string"&&m.trim().length>0&&(m.startsWith("http")?U(m):U(`${pe}${m}`))}).catch(t=>{v(a("company_settings.error.load"))}).finally(()=>{s&&G(!1)}),()=>{s=!1}},[d,a]),n.useEffect(()=>{let s=!0;async function t(){try{const i=await Xe();s&&Le(i)}catch{}finally{s&&Fe(!1)}}return t(),()=>{s=!1}},[]);const Ae=async s=>{if(s.preventDefault(),!!d){v(""),$(""),W(!0);try{await Qe(d,{name:z.trim(),description_geo:k.trim()||null,description_eng:F.trim()||null,description_rus:A.trim()||null,contact_email:X.trim()||null,phone_number:Q.trim()||null,website:Z.trim()||null,country:se.trim()||null,city:te.trim()||null,established_year:ne,base_price:ue,price_per_mile:fe,customs_fee:_e,service_fee:Ne,broker_fee:we,services:E.length>0?E:void 0});const t=f.filter(i=>!i.id&&i.url.trim());if(t.length>0&&await Promise.all(t.map(i=>Ve(d,"social",i.url.trim(),i.platform))),ce){const i=await Ze(d,ce);if(i.logoUrl){const p=i.logoUrl.startsWith("http")?i.logoUrl:`${pe}${i.logoUrl}`;U(p)}C&&(URL.revokeObjectURL(C),oe(null)),le(null)}await B(),$(a("company_settings.success")),w.success(a("company_settings.success"))}catch(t){const i=t instanceof Error?t.message:a("company_settings.error.save");v(i),w.error(i)}finally{W(!1)}}},De=async()=>{if(d){v(""),T(!0);try{await ss(d),await B(),w.success(a("company_settings.delete_success")),L("/dashboard",{replace:!0})}catch(s){const t=s instanceof Error?s.message:a("company_settings.error.delete");v(t),w.error(t)}finally{T(!1)}}},de=s=>{const t=s.target.files?.[0];if(t){le(t);const i=URL.createObjectURL(t);oe(i)}},Ee=(s,t)=>{P(t?i=>[...i,s]:i=>i.filter(p=>p!==s))},me=f.map(s=>s.platform),he=(s,t,i)=>{S(p=>p.map((m,R)=>R===s?{...m,[t]:i}:m))},Pe=()=>{S(s=>[...s,{platform:"facebook",url:""}])},Ue=async s=>{const t=f[s];if(S(i=>i.filter((p,m)=>m!==s)),t?.id&&d)try{await es(t.id)}catch{w.error(a("company_settings.error.delete_link"))}};return ge||xe?e.jsx("div",{className:"min-h-screen bg-muted/30 px-4 py-8",children:e.jsx("div",{className:"mx-auto max-w-2xl",children:e.jsxs(g,{children:[e.jsxs(j,{children:[e.jsx(_,{className:"h-6 w-48"}),e.jsx(_,{className:"h-4 w-64 mt-2"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsx(_,{className:"h-10 w-full"}),e.jsx(_,{className:"h-10 w-full"}),e.jsx(_,{className:"h-20 w-full"}),e.jsx(_,{className:"h-10 w-full"})]})]})})}):d?e.jsx("div",{className:"min-h-screen bg-muted/30 py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(b,{type:"button",variant:"ghost",size:"icon",onClick:()=>L(-1),"aria-label":a("common.back","Go back"),children:e.jsx(r,{icon:"mdi:arrow-left",className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:a("company_settings.title")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:a("company_settings.description")})]})]}),e.jsx("form",{onSubmit:Ae,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(g,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:domain",className:"h-5 w-5"}),a("company_settings.company_info","Company Information")]}),e.jsx(N,{children:a("company_settings.company_info_description","Basic information about your company")})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:a("company_settings.name")}),e.jsx(h,{id:"name",value:z,onChange:s=>H(s.target.value),placeholder:a("company_settings.name_placeholder"),required:!0,disabled:c||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"phoneNumber",children:a("company_settings.phone")}),e.jsx(h,{id:"phoneNumber",type:"tel",value:Q,onChange:s=>V(s.target.value),placeholder:a("company_settings.phone_placeholder","+1 234 567 8900"),disabled:c||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"contactEmail",children:a("company_settings.contact_email")}),e.jsx(h,{id:"contactEmail",type:"email",value:X,onChange:s=>K(s.target.value),placeholder:a("company_settings.email_placeholder","contact@company.com"),disabled:c||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"establishedYear",children:a("company_settings.established_year")}),e.jsx(h,{id:"establishedYear",type:"number",value:ne,onChange:s=>D(Number(s.target.value)),min:1900,max:2100,disabled:c||l})]})]})]}),e.jsxs(g,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:text-box-multiple",className:"h-5 w-5"}),a("company_settings.descriptions","Company Descriptions")]}),e.jsx(N,{children:a("company_settings.descriptions_description","Describe your company in multiple languages")})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"descriptionGeo",className:"flex items-center justify-between",children:[e.jsx("span",{children:a("company_settings.description_geo","Description (Georgian)")}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[k.length,"/5000"]})]}),e.jsx(I,{id:"descriptionGeo",value:k,onChange:s=>J(s.target.value),placeholder:a("company_settings.description_geo_placeholder","აღწერა ქართულად..."),disabled:c||l,rows:3,maxLength:5e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"descriptionEng",className:"flex items-center justify-between",children:[e.jsx("span",{children:a("company_settings.description_eng","Description (English)")}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[F.length,"/5000"]})]}),e.jsx(I,{id:"descriptionEng",value:F,onChange:s=>O(s.target.value),placeholder:a("company_settings.description_eng_placeholder","Description in English..."),disabled:c||l,rows:3,maxLength:5e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"descriptionRus",className:"flex items-center justify-between",children:[e.jsx("span",{children:a("company_settings.description_rus","Description (Russian)")}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[A.length,"/5000"]})]}),e.jsx(I,{id:"descriptionRus",value:A,onChange:s=>q(s.target.value),placeholder:a("company_settings.description_rus_placeholder","Описание на русском..."),disabled:c||l,rows:3,maxLength:5e3})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(g,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:web",className:"h-5 w-5"}),a("company_settings.website_social","Website & Social Links")]}),e.jsx(N,{children:a("company_settings.website_social_description","Add your company website and social media profiles")})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:web",className:"h-4 w-4"}),a("company_settings.website_label","Company Website")]}),e.jsx(h,{placeholder:"https://yourcompany.com",value:Z,onChange:s=>ee(s.target.value),disabled:c||l})]}),e.jsx(We,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:share-variant",className:"h-4 w-4"}),a("company_settings.social_links_label","Social Media Links")," (",f.length,"/2)"]})}),f.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a("company_settings.no_social_links","No social links added.")}),f.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:s.platform,onChange:i=>he(t,"platform",i.target.value),disabled:c||l,className:"h-9 w-[130px] rounded-md border border-input bg-transparent px-3 text-sm focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50",children:[e.jsx("option",{value:"facebook",disabled:me.includes("facebook")&&s.platform!=="facebook",children:"Facebook"}),e.jsx("option",{value:"instagram",disabled:me.includes("instagram")&&s.platform!=="instagram",children:"Instagram"})]}),e.jsx(h,{value:s.url,onChange:i=>he(t,"url",i.target.value),placeholder:s.platform==="facebook"?"https://facebook.com/page":"https://instagram.com/page",disabled:c||l,className:"flex-1"}),e.jsx(b,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ue(t),disabled:c||l,children:e.jsx(r,{icon:"mdi:trash-can-outline",className:"h-4 w-4"})})]},t)),f.length<2&&e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:Pe,disabled:c||l,className:"w-full",children:[e.jsx(r,{icon:"mdi:plus",className:"me-2 h-4 w-4"}),a("company_settings.add_social_link","Add Social Link")]})]})]})]}),e.jsxs(g,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:map-marker",className:"h-5 w-5"}),a("company_settings.location","Location")]}),e.jsx(N,{children:a("company_settings.location_description","Where your company is located")})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"country",children:a("company_settings.country")}),e.jsx(h,{id:"country",value:se,onChange:s=>ae(s.target.value),placeholder:a("company_settings.country_placeholder","United States"),disabled:c||l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"city",children:a("company_settings.city")}),e.jsx(h,{id:"city",value:te,onChange:s=>ie(s.target.value),placeholder:a("company_settings.city_placeholder","New York"),disabled:c||l})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(g,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:image",className:"h-5 w-5"}),a("company_settings.logo","Company Logo")]}),e.jsx(N,{children:a("company_settings.logo_description","Upload your company logo (max 2 MB, JPEG/PNG/WEBP)")})]}),e.jsx(x,{className:"space-y-4",children:C||re?e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:C||re||"",alt:"Company logo",className:"w-24 h-24 object-contain rounded-lg border bg-muted"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{type:"file",accept:"image/*",onChange:de,disabled:c||l}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:a("company_settings.logo_change","Click to change logo")})]})]}):e.jsxs("div",{children:[e.jsx(h,{type:"file",accept:"image/*",onChange:de,disabled:c||l}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:a("company_settings.logo_hint","JPEG, PNG, or WEBP up to 2 MB")})]})})]}),e.jsxs(g,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs(j,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(r,{icon:"mdi:briefcase",className:"h-5 w-5"}),a("company_settings.services","სერვისები")]}),e.jsx(N,{children:a("company_settings.services_description","სერვისები რომლებსაც თქვენი კომპანია სთავაზობს")})]}),e.jsx(x,{children:ke?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(r,{icon:"mdi:loading",className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:a("company_settings.loading_services","Loading services...")})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:Ce.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ge,{id:`service-${s.id}`,checked:E.includes(s.name),onCheckedChange:t=>Ee(s.name,t),disabled:c||l}),e.jsx(o,{htmlFor:`service-${s.id}`,className:"font-normal cursor-pointer",children:s.name})]},s.id))})})]})]}),e.jsx(g,{className:"shadow-sm",children:e.jsxs(x,{className:"pt-6",children:[Y&&e.jsx("p",{className:"text-sm text-destructive mb-4",children:Y}),M&&e.jsx("p",{className:"text-sm text-emerald-600 mb-4",children:M}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(b,{type:"submit",disabled:c||l,className:"flex-1",children:c?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),a("company_settings.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:content-save",className:"me-2 h-4 w-4"}),a("company_settings.save")]})}),e.jsxs(Te,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(b,{type:"button",variant:"destructive",disabled:c||l,children:[e.jsx(r,{icon:"mdi:delete",className:"me-2 h-4 w-4"}),a("company_settings.delete_company")]})}),e.jsxs(Me,{children:[e.jsxs($e,{children:[e.jsx(ze,{children:a("company_settings.delete_confirm_title")}),e.jsx(He,{children:a("company_settings.delete_confirm_description")})]}),e.jsxs(Je,{children:[e.jsx(Oe,{children:a("common.cancel")}),e.jsx(qe,{onClick:De,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:l?e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"mdi:loading",className:"me-2 h-4 w-4 animate-spin"}),a("company_settings.deleting")]}):a("company_settings.delete_confirm")})]})]})]})]})]})})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30 px-4",children:e.jsxs(g,{className:"w-full max-w-md text-center p-6",children:[e.jsx(j,{children:e.jsx(y,{children:a("company_settings.no_company")})}),e.jsxs(x,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("company_settings.no_company_description")}),e.jsxs(b,{onClick:()=>L("/company/onboard"),className:"w-full",children:[e.jsx(r,{icon:"mdi:domain-plus",className:"me-2 h-4 w-4"}),a("company_settings.create_company")]})]})]})})};export{ms as default};
